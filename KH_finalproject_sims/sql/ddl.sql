--통신사 테이블 생성
drop table BIZ cascade constraints;
CREATE TABLE BIZ (
    BIZ_ID	VARCHAR2(30) PRIMARY KEY ,
	BIZ_NAME	VARCHAR2(30)	NULL,
	BIZ_SSN	VARCHAR2(30)	NULL,
	BIZ_CRN	VARCHAR2(20)	NULL,
	BIZ_EMAIL	VARCHAR2(50)	NULL,
	BIZ_PHONE	VARCHAR2(20)	NULL,
	BIZ_FAX	VARCHAR2(20)	NULL,
	BIZ_OWNER_NAME	VARCHAR2(10)	NULL,
	BIZ_HP	VARCHAR2(100)	NULL,
    BIZ_ZIP_CODE NUMBER NULL,
	BIZ_LOCATION	VARCHAR2(200)	NULL,
	BIZ_CARD_PAY_DATE	VARCHAR2(20)	NULL,
	BIZ_ACC_PAY_DATE	VARCHAR2(20)	NULL,
	BIZ_BEGIN_TIME	VARCHAR2(20)	NULL,
	BIZ_END_TIME	VARCHAR2(20)	NULL,
	BIZ_CLOSED_DAY	VARCHAR2(20)	NULL,
	BIZ_REVIEW_STAR	NUMBER	NULL,
	PHONE_OP_TIME	VARCHAR2(20)	NULL,
	PHONE_OP_TIME_USIM	VARCHAR2(20)	NULL,
    NETWORK VARCHAR(20) NULL,
	WRITE_DATE	DATE	NOT NULL,
	UPDATE_DATE	DATE	NULL,
	LOGO_RENAME_FILENAME	VARCHAR2(100)	NULL,
    CONSTRAINT FK_BIZ_ID FOREIGN KEY (BIZ_ID) REFERENCES MEMBER(ID)
);


--BIZ 시퀀스 생성
DROP SEQUENCE BIZ_SEQ;
CREATE SEQUENCE BIZ_SEQ
       INCREMENT BY 1
       START WITH 1
       MINVALUE 1
       NOCYCLE
       NOCACHE
       ORDER;

-- 통신사통신망 테이블 BIZ_NETWORK 생성
DROP TABLE BIZ_NETWORK CASCADE CONSTRAINTS;
CREATE TABLE BIZ_NETWORK (
    BIZ_ID VARCHAR2(30) NOT NULL,
	NET_NO	NUMBER		NOT NULL,
	BIZ_NET_SERVICE	VARCHAR2(20)		NULL
);

ALTER TABLE BIZ_NETWORK ADD CONSTRAINT FK_BIZ_TO_BIZ_NETWORK_1 FOREIGN KEY (BIZ_ID) REFERENCES "BIZ" (BIZ_ID);

ALTER TABLE BIZ_NETWORK ADD CONSTRAINT FK_NETWORK_TO_BIZ_NETWORK_1 FOREIGN KEY (NET_NO) REFERENCES NETWORK_TABLE (NET_NO);

--질문/답변 게시판 생성
DROP TABLE QNA;
CREATE TABLE QNA (
    AQ_NO NUMBER NOT NULL PRIMARY KEY
    , USER_ID VARCHAR2(30) NOT NULL
    , AQ_TITLE VARCHAR2(50) NOT NULL
    , AQ_CONTENT VARCHAR2(4000) NOT NULL
    , AQ_DATE TIMESTAMP NOT NULL
    , AQ_REDATE TIMESTAMP 
    , AQ_VIEWS NUMBER NOT NULL
    , AQ_ANSWERS NUMBER NOT NULL
);
ALTER TABLE QNA ADD CONSTRAINT FK_USER_TO_QNA FOREIGN KEY (USER_ID) REFERENCES USER_TABLE(USER_ID);
ALTER TABLE QNA MODIFY AQ_DATE DEFAULT SYSTIMESTAMP;

ALTER TABLE QNA ADD(AQ_ANSWERS NUMBER);
UPDATE QNA
SET AQ_ANSWERS = (SELECT COUNT(*) FROM QNA_ANS WHERE AQ_NO = 6)
WHERE AQ_NO = 6;
ALTER TABLE QNA MODIFY AQ_ANSWERS NOT NULL;
ALTER TABLE QNA MODIFY AQ_ANSWERS DEFAULT 0;
ALTER TABLE QNA MODIFY AQ_VIEWS DEFAULT 0;
ALTER TABLE QNA MODIFY AQ_REDATE DEFAULT SYSTIMESTAMP;
ALTER TABLE QNA MODIFY AQ_TITLE VARCHAR2(100);

DROP SEQUENCE QNA_SEQ;
CREATE SEQUENCE QNA_SEQ
       INCREMENT BY 1
       START WITH 1
       MINVALUE 1
       NOCYCLE
       NOCACHE
       ORDER; 


--질문/답변 게시판의 답변 테이블
CREATE TABLE QNA_ANS (
    AA_NO NUMBER NOT NULL PRIMARY KEY
    , AQ_NO NUMBER NOT NULL
    , ADMIN_ID VARCHAR2(30) 
    , USER_ID VARCHAR2(30) 
    , AA_CONTENT VARCHAR2(4000) NOT NULL
    , AA_DATE TIMESTAMP NOT NULL
    , AA_REDATE TIMESTAMP 
);
ALTER TABLE QNA_ANS MODIFY AA_DATE DEFAULT SYSTIMESTAMP;
ALTER TABLE QNA_ANS ADD CONSTRAINT FK_ADMIN_TO_ANS FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN(ADMIN_ID);
ALTER TABLE QNA_ANS ADD CONSTRAINT FK_USER_TO_ANS FOREIGN KEY (USER_ID) REFERENCES USER_TABLE(USER_ID);
ALTER TABLE QNA_ANS ADD CONSTRAINT FK_QNA_TO_ANS FOREIGN KEY (AQ_NO)
REFERENCES QNA(AQ_NO) ON DELETE CASCADE;
ALTER TABLE QNA_ANS MODIFY AA_REDATE DEFAULT SYSTIMESTAMP;

DROP SEQUENCE QNA_ANS_SEQ;
CREATE SEQUENCE QNA_ANS_SEQ
       INCREMENT BY 1
       START WITH 1
       MINVALUE 1
       NOCYCLE
       NOCACHE
       ORDER;	

--질문/답변 게시판 답변의 댓글 테이블
CREATE TABLE QNA_RPL (
    RPL_NO NUMBER NOT NULL PRIMARY KEY
    , AA_NO NUMBER NOT NULL
    , RPL_DATE TIMESTAMP NOT NULL
    , RPL_REDATE TIMESTAMP
    , RPL_CONTENT VARCHAR2(4000) NOT NULL
    , USER_ID VARCHAR2(30)
    , ADMIN_ID VARCHAR2(30)
);
ALTER TABLE QNA_RPL MODIFY RPL_DATE DEFAULT SYSTIMESTAMP;
ALTER TABLE QNA_RPL ADD CONSTRAINT FK_ADMIN_TO_RPL FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN(ADMIN_ID);
ALTER TABLE QNA_RPL ADD CONSTRAINT FK_USER_TO_RPL FOREIGN KEY (USER_ID) REFERENCES USER_TABLE(USER_ID);
ALTER TABLE QNA_RPL ADD CONSTRAINT FK_ANS_TO_RPL FOREIGN KEY (AA_NO)
REFERENCES QNA_ANS(AA_NO) ON DELETE CASCADE;
ALTER TABLE QNA_RPL MODIFY RPL_REDATE DEFAULT SYSTIMESTAMP;
 
DROP SEQUENCE QNA_RPL_SEQ;
CREATE SEQUENCE QNA_RPL_SEQ
       INCREMENT BY 1
       START WITH 1
       MINVALUE 1
       NOCYCLE
       NOCACHE
       ORDER;


-- 통신사 리뷰
DROP TABLE BIZ_REVIEW;
CREATE TABLE BIZ_REVIEW (
    REVIEW_NO        NUMBER  NOT NULL PRIMARY KEY,
    REVIEW_CONTENT   VARCHAR2(4000) NOT NULL,
    REVIEW_DATE      TIMESTAMP NOT NULL,
    REVIEW_REDATE    TIMESTAMP NULL,
    REVIEW_STAR      NUMBER  NOT NULL,
    USER_ID          VARCHAR2(30) NOT NULL,
    BIZ_ID           VARCHAR2(30) NOT NULL,
    REVIEW_HIDDEN NUMBER DEFAULT 0 CHECK (REVIEW_HIDDEN IN (0, 1)), 
    CONSTRAINT FK_USER_ID2 FOREIGN KEY (USER_ID) REFERENCES USER_TABLE(USER_ID),
    CONSTRAINT FK_BIZ_ID1 FOREIGN KEY (BIZ_ID) REFERENCES BIZ(BIZ_ID)
);
DROP SEQUENCE BIZ_REVIEW_SEQ;
CREATE SEQUENCE BIZ_REVIEW_SEQ
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;
ALTER TABLE BIZ_REVIEW MODIFY REVIEW_DATE DEFAULT SYSTIMESTAMP;
ALTER TABLE BIZ_REVIEW MODIFY REVIEW_REDATE DEFAULT SYSTIMESTAMP;



-- 리뷰 신고내역 테이블
DROP table REVIEW_REPORT;
CREATE TABLE REVIEW_REPORT (
      REVIEW_NO NUMBER NOT NULL
    , REPORT_DATE DATE DEFAULT SYSDATE
    , REPORT_STATUS NUMBER CHECK(REPORT_STATUS IN (1,2,3))
    , REPORT_REASON VARCHAR2(50) NOT NULL
    , CONSTRAINT REVIEW_REPORT_REVIEW_NO_FK FOREIGN KEY(REVIEW_NO) REFERENCES BIZ_REVIEW(REVIEW_NO) ON DELETE CASCADE
);
ALTER TABLE REVIEW_REPORT ADD CONSTRAINT PK_REVIEW_REPORT PRIMARY KEY (REVIEW_NO);



-- 찜 내역 생성
-- CREATE TABLE LIKE_TABLE (
--     USER_NO NUMBER NOT NULL,
--     PLAN_NO NUMBER NOT NULL,
--     LIKE_DATE DATE,
--     LIKE_YN CHAR(1) NOT NULL
-- );
-- ALTER TABLE LIKE_TABLE ADD CONSTRAINT PK_LIKE_TABLE PRIMARY KEY (USER_NO, PLAN_NO);
-- ALTER TABLE LIKE_TABLE ADD CONSTRAINT FK_USER_TABLE_TO_LIKE_TABLE_1 
-- FOREIGN KEY (USER_ID) REFERENCES USER_TABLE (USER_ID);
-- ALTER TABLE PLAN_TABLE ADD CONSTRAINT PK_PLAN_TABLE PRIMARY KEY(PLAN_NO);
-- ALTER TABLE LIKE_TABLE ADD CONSTRAINT FK_PLAN_TABLE_TO_LIKE_TABLE_1 
-- FOREIGN KEY (PLAN_NO) REFERENCES PLAN_TABLE (PLAN_NO);
-- ALTER TABLE LIKE_TABLE DROP COLUMN LIKE_YN;
DROP TABLE LIKE_TABLE;

CREATE TABLE LIKE_TABLE (
	PLAN_NO	NUMBER	NOT NULL,
	USER_ID	VARCHAR2(30)	NOT NULL,
	LIKE_DATE DATE
);
ALTER TABLE LIKE_TABLE MODIFY  LIKE_DATE DATE DEFAULT SYSDATE NOT NULL;

ALTER TABLE LIKE_TABLE ADD CONSTRAINT PK_LIKE_TABLE PRIMARY KEY (
	PLAN_NO,
	USER_ID
);

ALTER TABLE LIKE_TABLE ADD CONSTRAINT FK_PLAN_TABLE_TO_LIKE_TABLE_1 FOREIGN KEY (
	PLAN_NO
)
REFERENCES PLAN_TABLE (
	PLAN_NO
);

ALTER TABLE LIKE_TABLE ADD CONSTRAINT FK_USER_TABLE_TO_LIKE_TABLE_1 FOREIGN KEY (
	USER_ID
)
REFERENCES USER_TABLE (
	USER_ID
);



-- 공지사항 테이블
create table NOTICE(
    NTC_NO NUMBER primary key,
    ADMIN_ID VARCHAR2(30) not null,
    NTC_TITLE VARCHAR2(300) not null,
    NTC_CONTENT CLOB not null,
    NTC_REWRITER VARCHAR2(30) NULL,
    NTC_DATE TIMESTAMP DEFAULT systimestamp,
    NTC_REDATE TIMESTAMP null,
    CONSTRAINT NOTICE_ADMIN_ID_FK FOREIGN KEY(ADMIN_ID) REFERENCES ADMIN(ADMIN_ID),
    CONSTRAINT NOTICE_NTC_REWRITER_FK FOREIGN KEY(NTC_REWRITER) REFERENCES ADMIN(ADMIN_ID)
);
ALTER TABLE NOTICE ADD CONSTRAINT FK_ADMIN_TO_NOTICE
FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN(ADMIN_ID);
ALTER TABLE NOTICE ADD CONSTRAINT FK_ADMIN_TO_NOTICE_2
FOREIGN KEY (NTC_REWRITER) REFERENCES ADMIN(ADMIN_ID);
ALTER TABLE NOTICE MODIFY NTC_REDATE DEFAULT SYSTIMESTAMP;

-- 공지번호 시퀀스 생성
CREATE SEQUENCE NTC_NO_SEQ
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

-- 사용자
DROP TABLE USER_TABLE CASCADE CONSTRAINTS;
CREATE TABLE USER_TABLE(
      USER_ID VARCHAR2(30) 
	, USER_NAME VARCHAR2(10) NOT NULL
	, USER_SSN VARCHAR2(20) NOT NULL
	, USER_WR_DATE DATE NOT NULL
	, USER_UP_DATE DATE
	, USER_GENDER CHAR(1) NULL CHECK (USER_GENDER IN ('M','F'))
	, USER_PHONE VARCHAR2(20)
	, USER_EMAIL VARCHAR2(30)
	, USER_ADDRESS VARCHAR2(100)
    , CONSTRAINT PK_USER_ID PRIMARY KEY (USER_ID)
    , CONSTRAINT FK_USER_ID FOREIGN KEY (USER_ID) REFERENCES MEMBER(ID)
);
alter table user_table drop column user_address;

--관리자
DROP TABLE ADMIN CASCADE CONSTRAINTS;
CREATE TABLE ADMIN (
	ADMIN_ID	VARCHAR2(30)	NOT NULL,
	ADMIN_TYPE	VARCHAR2(80)	NOT NULL
);

ALTER TABLE ADMIN ADD CONSTRAINT PK_ADMIN PRIMARY KEY (ADMIN_ID);
ALTER TABLE ADMIN ADD CONSTRAINT FK_MEMBER_TO_ADMIN_1 FOREIGN KEY (ADMIN_ID) REFERENCES MEMBER(ID);

-- 맞춤질문지 생성
DROP TABLE CUSTOM_Q;
CREATE TABLE CUSTOM_Q (
    USER_NO NUMBER NOT NULL,
    CQ_TELECOM NUMBER CHECK(CQ_TELECOM IN (1,2,3,4)),
    CQ_DATA NUMBER CHECK(CQ_DATA IN (1,2,3,4,5)),
    CQ_SPEED NUMBER CHECK(CQ_SPEED IN (1,2)),
    CQ_VOICE NUMBER CHECK(CQ_VOICE IN (1,2,3,4)),
    CONSTRAINT CUSTOM_Q_USER_NO_FK FOREIGN KEY (USER_NO) REFERENCES USER_TABLE (USER_NO)
);
ALTER TABLE CUSTOM_Q RENAME COLUMN USER_NO TO USER_ID;
ALTER TABLE CUSTOM_Q MODIFY USER_ID VARCHAR2(30);
ALTER TABLE CUSTOM_Q ADD CONSTRAINT FK_USER_TO_CQ
FOREIGN KEY (USER_ID) REFERENCES USER_TABLE (USER_ID);
ALTER TABLE CUSTOM_Q ADD CONSTRAINT PK_CUSTOM_Q PRIMARY KEY (USER_ID);

-- 요금제 조회 생성
DROP TABLE VIEW_TABLE;
CREATE TABLE VIEW_TABLE (
   USER_NO NUMBER NOT NULL ,
   PLAN_NO NUMBER NOT NULL ,
   VIEW_DATE TIMESTAMP DEFAULT SYSTIMESTAMP ,
   CONSTRAINT VIEW_TABLE_USER_NO_FK FOREIGN KEY (USER_NO) REFERENCES USER_TABLE (USER_NO),
   CONSTRAINT VIEW_TABLE_PLAN_NO_FK FOREIGN KEY (PLAN_NO) REFERENCES PLAN_TABLE (PLAN_NO) 
);
TRUNCATE TABLE VIEW_TABLE;
ALTER TABLE VIEW_TABLE RENAME COLUMN USER_NO TO USER_ID;
ALTER TABLE VIEW_TABLE MODIFY USER_ID VARCHAR2(30);
ALTER TABLE VIEW_TABLE ADD CONSTRAINT FK_USER_TO_VIEW
FOREIGN KEY (USER_ID) REFERENCES USER_TABLE (USER_ID);
ALTER TABLE VIEW_TABLE ADD CONSTRAINT FK_PLAN_TO_VIEW
FOREIGN KEY (PLAN_NO) REFERENCES PLAN_TABLE (PLAN_NO);
ALTER TABLE VIEW_TABLE ADD CONSTRAINT PK_VIEW PRIMARY KEY (USER_ID, PLAN_NO);

-- 요금제 가입정보 테이블 생성
DROP TABLE PLAN_ORDER;
CREATE TABLE PLAN_ORDER(
    ORDER_NO NUMBER NOT NULL,
    USER_ID VARCHAR2(30) NOT NULL,
    PLAN_NO NUMBER NOT NULL,
    JOIN_CATEGORY CHAR(1) NOT NULL CHECK(JOIN_CATEGORY IN (1,2)),
    SIM_TYPE CHAR(1) NOT NULL CHECK(SIM_TYPE IN (1,2)),
    SIM_YN CHAR(1) NOT NULL,
    CURRENT_TELECOM CHAR(1) CHECK(CURRENT_TELECOM IN (1,2,3,4,5)),
    PLAN_BILL CHAR(1) CHECK(PLAN_BILL IN (1,2)),
    PLAN_PAY CHAR(1) CHECK(PLAN_PAY IN (1,2)),
    CARD_NUMBER VARCHAR2(20),
    CARD_EXPIRATION VARCHAR2(10),
    BANK VARCHAR2(30),
    BANK_NUMBER VARCHAR2(50),
    ORDER_DATE DATE,
    ORDER_STATUS CHAR(1) CHECK(ORDER_STATUS IN (1,2,3)),
    NET_NO NUMBER,
    GEN_NO NUMBER,
    ORDER_PRICE NUMBER,
    ORDER_DATA NUMBER,
    ORDER_VOICE NUMBER,
    ORDER_MESSAGE NUMBER,
    CONSTRAINT PLAN_ORDER_ORDER_NO_PK PRIMARY KEY (ORDER_NO),
   	CONSTRAINT PLAN_ORDER_USER_NO_FK FOREIGN KEY (USER_ID) REFERENCES USER_TABLE (USER_ID),
   	CONSTRAINT PLAN_ORDER_PLAN_NO_FK FOREIGN KEY (PLAN_NO) REFERENCES PLAN_TABLE (PLAN_NO),
   	CONSTRAINT PLAN_ORDER_NET_NO_FK FOREIGN KEY (NET_NO) REFERENCES NETWORK_TABLE (NET_NO),
   	CONSTRAINT PLAN_ORDER_GEN_NO_FK FOREIGN KEY (GEN_NO) REFERENCES TEL_GEN_TABLE (GEN_NO)
);
ALTER TABLE PLAN_ORDER MODIFY ORDER_DATE DEFAULT SYSTIMESTAMP;
DROP SEQUENCE PLAN_ORDER_SEQ;
CREATE SEQUENCE PLAN_ORDER_SEQ
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;
ALTER TABLE PLAN_ORDER MODIFY GEN_NO NOT NULL;
ALTER TABLE PLAN_ORDER MODIFY NET_NO NOT NULL;
ADD CONSTRAINT PLAN_ORDER_SIM_YN_CHECK CHECK(SIM_YN IN (1,2));

ALTER TABLE plan_order ADD biz_id varchar2(30);
ALTER TABLE plan_order ADD CONSTRAINT fk_biz_id2 FOREIGN KEY (biz_id)
REFERENCES biz(biz_id);

alter table plan_order add order_address varchar2(500);

ALTER TABLE PLAN_ORDER DROP (CARD_NUMBER, CARD_EXPIRATION, BANK, BANK_NUMBER);

--- 카드납부정보 테이블
CREATE TABLE PAYINFO_CARD (
    ORDER_NO NUMBER NOT NULL PRIMARY KEY
    , CARD_HOLDER VARCHAR2(20)
    , CARD_SSN VARCHAR2(20)
    , CARD_RELATIONSHIP NUMBER
    , CARD_NUMBER VARCHAR2(30)
    , CARD_EXPIRATION VARCHAR2(10)
);
ALTER TABLE PAYINFO_CARD ADD CONSTRAINT FK_ORDER_TO_CARD FOREIGN KEY (ORDER_NO) 
REFERENCES PLAN_ORDER (ORDER_NO);
ALTER TABLE PAYINFO_CARD ADD CONSTRAINT CARD_RELATIONSHIP_CHECK CHECK(CARD_RELATIONSHIP IN (1,2,3,4));

--- 계좌납부정보 테이블
CREATE TABLE PAYINFO_ACC (
    ORDER_NO NUMBER NOT NULL PRIMARY KEY
    , ACC_HOLDER VARCHAR2(20)
    , ACC_SSN VARCHAR2(20)
    , ACC_RELATIONSHIP NUMBER
    , ACC_NUMBER VARCHAR2(50)
    , ACC_BANK VARCHAR2(30)
);
ALTER TABLE PAYINFO_ACC ADD CONSTRAINT FK_ORDER_TO_ACC FOREIGN KEY (ORDER_NO) 
REFERENCES PLAN_ORDER (ORDER_NO);
ALTER TABLE PAYINFO_ACC ADD CONSTRAINT ACC_RELATIONSHIP_CHECK CHECK(ACC_RELATIONSHIP IN (1,2,3,4));

--- 자주묻는질문 테이블
DROP TABLE FAQ;
CREATE TABLE FAQ (
	FAQ_NO	NUMBER PRIMARY KEY	NOT NULL,
	FAQ_TITLE	VARCHAR2(300)	NOT NULL,
	FAQ_CONTENT	CLOB	NULL,
	ADMIN_ID	VARCHAR2(30)	NOT NULL,
	FAQ_REWRITER	VARCHAR2(30)	NULL,
	FAQ_DATE DATE DEFAULT (SYSDATE),
	FAQ_REDATE DATE DEFAULT (SYSDATE),
    CONSTRAINT FAQ_ADMIN_ID_FK FOREIGN KEY(ADMIN_ID) REFERENCES ADMIN(ADMIN_ID),
    CONSTRAINT FAQ_FAQ_REWRITER_FK FOREIGN KEY(FAQ_REWRITER) REFERENCES ADMIN(ADMIN_ID)
);
-- 질문번호 시퀀스 생성 
CREATE SEQUENCE FAQ_NO_SEQ
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;


-- 멤버테이블 생성(관리자, 사용자, 통신사 모두 포함)
DROP TABLE MEMBER;
CREATE TABLE MEMBER (
	ID	VARCHAR2(30) PRIMARY KEY,
	PW	VARCHAR2(80)	NOT NULL,
	ROLE	VARCHAR2(20)	NOT NULL,
	ENABLE	NUMBER	NOT NULL,
	OPINION VARCHAR2(1000) NULL
);
 


 ---이동통신세대 테이블
DROP TABLE IF EXISTS TEL_GEN_TABLE;

CREATE TABLE TEL_GEN_TABLE (
	GEN_NO	NUMBER	NOT NULL,
	GEN_NAME	VARCHAR2(10)	NOT NULL
);

ALTER TABLE TEL_GEN_TABLE ADD CONSTRAINT PK_TEL_GEN_TABLE PRIMARY KEY (
	GEN_NO
);

--- 통신망 테이블
DROP TABLE IF EXISTS NETWORK_TABLE;

CREATE TABLE NETWORK_TABLE (
	NET_NO	NUMBER	NOT NULL,
	NET_NAME	VARCHAR2(90)	NULL
);

ALTER TABLE NETWORK_TABLE ADD CONSTRAINT PK_NETWORK_TABLE PRIMARY KEY (
	NET_NO
);

-- 요금제 테이블
DROP TABLE  PLAN_TABLE;

CREATE TABLE PLAN_TABLE (
	PLAN_NO	NUMBER	primary key,
	PLAN_NAME	VARCHAR2(300)	NOT NULL,
	BIZ_NAME	VARCHAR2(30)	NOT NULL,
	NET_NO	NUMBER	 NULL,
	GEN_NO	NUMBER	 NULL,
	PLAN_PRICE	VARCHAR2(15)	NULL,
	PLAN_VOICE	VARCHAR2(15)	NULL,
	PLAN_MESSAGE	VARCHAR2(15)	NULL,
	PLAN_DATA	VARCHAR2(15)	NULL,
	PLAN_VOICE_OVER	VARCHAR2(15)	NULL,
	PLAN_MESSAGE_OVER	VARCHAR2(15)	NULL,
	PLAN_DATA_OVER	VARCHAR2(15)	NULL,
	PLAN_DATE	DATE	NULL,
	PLAN_UPDATE_DATE	DATE	NULL,
    CONSTRAINT FK_PLAN_NET_NO FOREIGN KEY (NET_NO) REFERENCES NETWORK_TABLE(NET_NO),
    CONSTRAINT FK_PLAN_GEN_NO FOREIGN KEY (GEN_NO) REFERENCES TEL_GEN_TABLE(GEN_NO)
);
-- 요금제 시퀀스
DROP SEQUENCE PLAN_SEQ;

CREATE SEQUENCE PLAN_SEQ NOCACHE;

-- VIEW 테이블
DROP TABLE VIEW_TABLE;

CREATE TABLE VIEW_TABLE(
	USER_ID	VARCHAR2(30) NOT NULL,
	PLAN_NO	NUMBER	NOT NULL,
	VIEW_DATE	TIMESTAMP NOT NULL 
);

ALTER TABLE VIEW_TABLE MODIFY VIEW_DATE TIMESTAMP DEFAULT SYSTIMESTAMP;


------PLAN_ORDER
DROP TABLE PLAN_ORDER;

CREATE TABLE PLAN_ORDER (
	ORDER_NO	NUMBER	NOT NULL,
	BIZ_ID	VARCHAR2(30)	NOT NULL,
	USER_ID	VARCHAR2(30)	NOT NULL,
	PLAN_NO	NUMBER	NOT NULL,
	JOIN_CATEGORY CHAR(1)	NOT NULL	,
	SIM_TYPE	CHAR(1)	NOT NULL	,
	SIM_YN	CHAR(1)	NOT NULL	,
	CURRENT_TELECOM	CHAR(1)	NULL	,
	PLAN_BILL	CHAR(1)	NULL	,
	PLAN_PAY	CHAR(1)	NULL	,
	ORDER_DATE	DATE	NULL,
	ORDER_STATUS	CHAR(1)	NULL,
	NET_NO	NUMBER	NOT NULL,
	GEN_NO	NUMBER	NOT NULL,
	ORDER_PRICE	NUMBER	NULL,
	ORDER_DATA	NUMBER	NULL,
	ORDER_VOICE	NUMBER	NULL,
	ORDER_MESSAGE	NUMBER	NULL,
	ORDER_ADDRESS	VARCHAR(500)	NULL
);

ALTER TABLE PLAN_ORDER ADD CONSTRAINT PK_PLAN_ORDER PRIMARY KEY (
	ORDER_NO
);


-- biz_review
DROP TABLE  BIZ_REVIEW;

CREATE TABLE BIZ_REVIEW (
	REVIEW_NO	NUMBER	NOT NULL,
	REVIEW_CONTENT	VARCHAR2(4000)	NOT NULL,
	REVIEW_DATE	TIMESTAMP,
	REVIEW_REDATE	TIMESTAMP,
	REVIEW_STAR	NUMBER	NOT NULL,
	USER_ID	VARCHAR2(30)	NOT NULL,
	BIZ_ID	VARCHAR2(30)	NOT NULL,
	REVIEW_HIDDEN	NUMBER	NULL
);

ALTER TABLE BIZ_REVIEW ADD CONSTRAINT PK_BIZ_REVIEW PRIMARY KEY (
	REVIEW_NO
);
ALTER TABLE BIZ_REVIEW MODIFY  REVIEW_REDATE TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL;
ALTER TABLE BIZ_REVIEW MODIFY  REVIEW_DATE TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL;


---------REVIEW_REPORT
DROP TABLE REVIEW_REPORT;

CREATE TABLE REVIEW_REPORT (
	REVIEW_NO	NUMBER	NOT NULL,
	REPORT_DATE	DATE,
	REPORT_STATUS	NUMBER	NULL,
	REPORT_REASON	VARCHAR2(50)	NOT NULL
);
ALTER TABLE REVIEW_REPORT MODIFY  REPORT_DATE DATE DEFAULT SYSDATE NOT NULL;
ALTER TABLE REVIEW_REPORT ADD CONSTRAINT PK_REVIEW_REPORT PRIMARY KEY (
	REVIEW_NO
);

ALTER TABLE REVIEW_REPORT ADD CONSTRAINT FK_BIZ_REVIEW_TO_REVIEW_REPORT_1 FOREIGN KEY (
	REVIEW_NO
)
REFERENCES BIZ_REVIEW (
	REVIEW_NO
);